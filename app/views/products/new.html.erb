<div class="row">

  <div style="padding: 25px" class="small-12 medium-6 large-6 columns">

    <h3>Add Product</h3> <br>

    <%= form_tag '/search', method: :get do %>

      <%= label_tag :keyword %>
      <%= text_field_tag :keyword %><br>

      <%= submit_tag 'Search' %>

    <% end %>

    <%= form_tag '/products', method: :post, multipart: true do %>

      <%= label_tag :name %>
      <%= text_field_tag :name %> <br>

      <%= label_tag :brand %>
      <%= text_field_tag :brand %> <br>

      <%= label_tag :product_type %>
      <%= text_field_tag :product_type %> <br>

      <%= file_field_tag :image, id: 'preview' %><br><br>

      <%= hidden_field_tag :red, nil, id: 'red' %>

      <%= hidden_field_tag :green, nil, id: 'green' %>

      <%= hidden_field_tag :blue, nil, id: 'blue' %>

      <%= submit_tag 'Finish', class: 'button' %><br>

    <% end %>

  </div>

  <div style="padding: 25px" class="small-12 medium-6 large-6 columns">
    <div id="target"></div><br>
    <div class="swatch-box" id="swatch"></div><br>
  </div>

</div>

<script type="text/javascript">

$(function() {
  $('#preview').on('change', function(event) {

    document.getElementById("red").value = "";
    document.getElementById("green").value = "";
    document.getElementById("blue").value = "";

    var files = event.target.files;
    var previewImage = files[0];
    var reader = new FileReader();
    reader.onload = function(file) {
      var img = new Image();
      img.src = file.target.result;
      $('#target').html(img);

      var colorThief = new ColorThief();
      var dominantColor = colorThief.getColor(img);

      document.getElementById("red").value = dominantColor[0];
      document.getElementById("green").value = dominantColor[1];
      document.getElementById("blue").value = dominantColor[2];

      document.getElementById("swatch").style["background-color"] = 'rgb(' + dominantColor[0] + ',' + dominantColor[1] + ',' + dominantColor[2] + ')';

      console.log(dominantColor);
    }
    reader.readAsDataURL(previewImage);
  });
});

</script>