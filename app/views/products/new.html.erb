<div class="row">
<h3>Add Product</h3>

  <div style="padding: 25px" class="small-12 medium-6 large-6 columns">

  <%= form_for :color do |color| %>
    <%= label_tag :red %>
    <%= color.text_field :red, id: 'red' %><br>

    <%= label_tag :green %>
    <%= color.text_field :green, id: 'green' %><br>

    <%= label_tag :blue %>
    <%= color.text_field :blue, id: 'blue' %><br>

    <%= color.fields_for :product, html: { multipart: true } do |product| %>
      <%= product.file_field :image, id: 'preview' %><br>

      <%= label_tag :name %>
      <%= product.text_field :name %> <br>

      <%= label_tag :brand %>
      <%= product.text_field :brand %> <br>

      <%= label_tag :product_type %>
      <%= product.text_field :product_type %> <br>

      <%= label_tag :color_id %>
      <%= product.text_field :color_id, value: Color.all.length + 1 %> <br> 
    <% end %>

    <%= submit_tag 'Finish', class: 'button' %>

  <% end %>

  </div>

  <div style="padding: 25px" id="target" class="small-12 medium-6 large-6 columns"></div>

</div>

<script type="text/javascript">

$(function() {
  $('#preview').on('change', function(event) {

    document.getElementById("red").value = "";
    document.getElementById("green").value = "";
    document.getElementById("blue").value = "";

    var files = event.target.files;
    var previewImage = files[0];
    var reader = new FileReader();
    reader.onload = function(file) {
      var img = new Image();
      img.src = file.target.result;
      $('#target').html(img);

      var colorThief = new ColorThief();
      var dominantColor = colorThief.getColor(img);

      document.getElementById("red").value = dominantColor[0];
      document.getElementById("green").value = dominantColor[1];
      document.getElementById("blue").value = dominantColor[2];

      console.log(dominantColor);
    }
    reader.readAsDataURL(previewImage);
  });
});

</script>